<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>게시글목록</title>
  <style>
    h2 {
      text-align: center;
    }
    form {
      max-width: 900px;
      margin: 0 auto;
    }
    table {
      width: 100%;
    }
    thead {
      background-color: #f2f2f2;
    }
    th, td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    .row:hover {
      background-color: #f2f2f2;
    }
    .chk {
      width: 10%;
    }
  </style>
<!-- async: html dom트리 형성후 수행됨-->
<!--  <script src="/js/board/all.js" async></script>-->
</head>
<body>
<h2>게 시 판</h2>
<form id="frm" action="/boards/del" method="POST">
  <div>
    <table>
      <thead>
      <tr>
        <td id="selectAll">전체선택</td>
        <td>아이디</td>
        <td>제목</td>
        <td>작성 날짜</td>
      </tr>
      </thead>
      <tbody id="rows">
      <tr class="row" th:each="board :${list}"  th:data-user-id="${board.userId}">
        <td class="chk"><input type="checkbox" name="uids" th:value="${board.userId}"></td>
        <td th:text="${board.userId}"></td>
        <td th:text="${board.title}"></td>
        <td th:text="${board.cdate}"></td>
      </tr>
      </tbody>
    </table>
  </div>
  <div>
    <button type="submit" id="delBtn">삭제</button>
    <button type="button" id="addBtn">등록</button>
  </div>
</form>
<script>
  //등록
  const $addBtn = document.getElementById('addBtn');
  $addBtn.addEventListener('click', evt=>{
    location.href = '/boards/add';                // GET   http://localhost:9080//boards/add
  });

  const $rows = document.getElementById('rows');
  $rows.addEventListener('click',evt=>{
    //1) input요소 이면서 checkbox는 제외
    if(evt.target.tagName === 'INPUT' &&  evt.target.getAttribute('type') == 'checkbox') {
      return;
    };
    //2) td요소중  checkbox있는 td는 제외
     if(evt.target.tagName == 'TD' && evt.target.classList.contains('chk')){
      return;
    }
    const $row = evt.target.closest('.row');
    const userId = $row.dataset.userId;
    location.href = `/boards/${userId}/detail`;    // GET http://localhost:9080/아이디/detail
  });

  //삭제
  const frm = document.getElementById('frm');
  frm.addEventListener('submit', evt=>{
    evt.preventDefault();  //기본 이벤트(submit) 중지
    if(!window.confirm('삭제하시겠습니까?')) return;
    evt.target.submit();
  });

  ///전체선택
  //일부 체크박스가 체크되어있다면 언체크, 그렇지 않으면 모든 체크박스를 체크
  const $selectAll = document.getElementById('selectAll');
  $selectAll.addEventListener('click',evt=>{
    //Array.from(iteral) : iteral객체를 배열로 변환
    const $inputs = Array.from(document.querySelectorAll('#rows input[type=checkbox]'));
    const isSomeChecked = $inputs.some(input=>input.checked == true)
    if(isSomeChecked) {
      $inputs.forEach(input=>input.checked = false);  // 일부 체크박스가 uncheck면 모든 체크박스를 unchecked 변경
    }else{
      $inputs.forEach(input=>input.checked = true);  // 모든 체크박스를 checked로 변경
    }
  });
</script>
</body>
</html>